#!/usr/bin/env sh

# This is very basic at the moment. We could do with more make style
# build tool and checks the input dates to see if it actually needs rebuilding.

mkdir -p public/posts

echo "## Generating HTML posts"
for md_file in posts/*.md; do
  base_name=$(basename "$md_file" .md)
  html_file="public/posts/${base_name}.html"
  if [ ! -f "$html_file" ] || [ "$md_file" -nt "$html_file" ]; then
    echo "  Building $base_name.html"
    multimarkdown parse -r "$md_file" > "$html_file"
  fi
done

echo "## Remove any additional HTML posts"
for html_file in public/posts/*.html; do
  base_name=$(basename "$html_file" .html)
  md_file="posts/${base_name}.md"
  if [ ! -f "$md_file" ]; then
    echo "  Removing $base_name.html"
    rm "$html_file"
  fi
done

cargo -q run

echo "## Generating 404.html"
multimarkdown parse -r pages/404.md > public/404.html

echo "## Generating about.html"
multimarkdown parse -r pages/about.md > public/about.html

